---
title: "coparison of binning for aquaflow datasets"
author: "Daniel HÃ¶hn"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(pracma)
```

```{r read data H}
s_blank_pure_1 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank1_summary.csv")
s_blank_pure_2 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank2_summary.csv")
s_blank_pure_3 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank3_summary.csv")

s_blank_standard_1 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank_SW_MI_I_1_pos_summary.csv")
s_blank_standard_2 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank_SW_MI_I_2_pos_summary.csv")
s_blank_standard_3 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank_SW_MI_I_3_pos_summary.csv")

s_full_1 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_C1_S1_W_MI_1_pos_summary.csv")
s_full_2 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_C1_S1_W_MI_2_pos_summary.csv")
s_full_3 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_C1_S1_W_MI_3_pos_summary.csv")

bins_blank_pure_1 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank1_selectBins_full.csv")
bins_blank_pure_2 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank2_selectBins_full.csv")
bins_blank_pure_3 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank3_selectBins_full.csv")

bins_blank_standard_1 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank_SW_MI_I_1_pos_selectBins_full.csv")
bins_blank_standard_2 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank_SW_MI_I_2_pos_selectBins_full.csv")
bins_blank_standard_3 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_Blank_SW_MI_I_3_pos_selectBins_full.csv")

bins_full_1 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_C1_S1_W_MI_1_pos_selectBins_full.csv")
bins_full_2 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_C1_S1_W_MI_2_pos_selectBins_full.csv")
bins_full_3 = read.csv("G:/_Studium/Analytik-Praktikum/bin/Daten_AquaFlow/210229_C1_S1_W_MI_3_pos_selectBins_full.csv")

```

```{r read data L}

```

```{r unified summary frame}
summaries = c("s_blank_pure_1", "s_blank_pure_2", "s_blank_pure_3",
              "s_blank_standard_1", "s_blank_standard_2", "s_blank_standard_3",
              "s_full_1", "s_full_2", "s_full_3")

sum_all = data.frame(errorcode = 0, sample = "none", bin_count = 0, total_points = 0, average_size = 0, mean_DQS = 0, mean_stdev = 0, perc_goodbins = 0)

for (name in summaries) {
  measurement = get(name) %>% group_by(errorcode) %>% summarise(sample = name, bin_count = n(), total_points = sum(size), average_size = sum(size)/n(), mean_DQS = mean(DQSB_base), mean_stdev = mean(stdev_mz))
  sum_all = rbind(sum_all, measurement)
}
sum_all = sum_all[-1,]
sum_all$errorcode = as.numeric(lapply(sum_all$errorcode, bits))
sum_all$errorcode = sum_all$errorcode - 10000000

```
Error codes:
     0 - No positive Test
     1 - at least one duplicate scan in bin
    10 - a point exists within maxdist of n+1 (left)
   100 - a point exists within maxdist of n+1 (left)
  1000 - mean and median in mz are more than two times the average centroid error (mz) apart
 10000 - a point exists outside the 3-sigma interval
100000 - the average DQS is < 0.5

```{r trends by sample}
ggplot(sum_all)+
  geom_point(aes(as.factor(sample), mean_DQS, color = as.factor(errorcode)))+
  scale_x_discrete(guide = guide_axis(n.dodge=3))

ggplot(sum_all)+
  geom_point(aes(as.factor(sample), mean_stdev, color = as.factor(errorcode)))+
  scale_x_discrete(guide = guide_axis(n.dodge=3))

ggplot(sum_all %>% group_by(sample) %>% summarise(perc_good = sum(errorcode == 0)/n()))+
  geom_col(aes(as.factor(sample), perc_good))+
  scale_x_discrete(guide = guide_axis(n.dodge=3))

```

